{% extends "base/AdminDashboard.html" %}
{% block content %}

<style>

/* Calendar container */
#calendar {
  font-size: 0.9rem;
  background-color: #fff;
  border-radius: 0.75rem;
  padding: 1.5rem;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.03);
  min-height: 600px; /* add this */
  overflow: hidden;   /* optional, hides scroll */
}

.fc .fc-toolbar-title {
  font-size: 2.3rem; /* or 24px */
  font-weight: bold;
}

/* Calendar buttons */
.fc .fc-button {
  background-color: #1f2937; /* Gray-800 */
  color: #fff;
  border: none;
  font-size: 1rem;
  padding: 0.45rem 0.9rem;
  margin: 0 2px;
  border-radius: 0.375rem;
  text-transform: capitalize;
  transition: all 0.2s ease-in-out;
}



/* Month & general views */
.fc-event {
  border-radius: 0.5rem;
  padding: 5px 8px;
  font-size: 0.975rem;
  font-weight: 500;
  border: 1px solid #cbd5e1;
  color: #fff !important;
  background-color: #6c757d; /* fallback default */
  transition: all 0.2s ease-in-out;
  cursor: pointer;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06);
}

/* Week/Day view (timeGrid) */
.fc-timegrid-event-harness .fc-event,
.fc-timegrid-event .fc-event-main {
  color: #fff !important;
  background-color: inherit !important;
  border: none !important;
}

/* List view */
.fc-list-event {
  background-color: inherit !important;
  border-left: 4px solid currentColor;
}
.fc-list-event .fc-event-title,
.fc-list-event-title {
  color: #fff !important;
}

/* Hover */
.fc-event:hover {
  opacity: 0.95;
  transform: scale(1.02);
  box-shadow: 0 4px 8px rgba(0,0,0,0.12);
  z-index: 10;
}

/* Label colors - readable text for light backgrounds */
.fc-event.fc-primary, .fc-primary {
  background-color: #dbeafe !important;
  color: #1d4ed8 !important;
}
.fc-event.fc-success, .fc-success {
  background-color: #dcfce7 !important;
  color: #15803d !important;
}
.fc-event.fc-danger, .fc-danger {
  background-color: #fee2e2 !important;
  color: #b91c1c !important;
}
.fc-event.fc-warning, .fc-warning {
  background-color: #fef3c7 !important;
  color: #92400e !important;
}
.fc-event.fc-info-solid, .fc-info-solid {
  background-color: #cffafe !important;
  color: #0369a1 !important;
}
.fc-event.fc-warning-solid, .fc-warning-solid {
  background-color: #fef9c3 !important;
  color: #78350f !important;
}
.fc-event.fc-primary-solid, .fc-primary-solid {
  background-color: #e0f2fe !important;
  color: #1e3a8a !important;
}
.fc-event.fc-default, .fc-default {
  background-color: #f3f4f6 !important;
  color: #374151 !important;
}
/* Apply text color directly inside event content */
.fc-event .fc-event-title,
.fc-event .fc-event-time,
.fc-event .fc-event-main {
  color: inherit !important;
}
/* Remove event border */
.fc-event {
  border: none !important;
  box-shadow: none !important;
}
/* Default for desktop */
.fc .fc-button {
  font-size: 1rem;
  padding: 0.45rem 0.9rem;
}

/* Tablets */
@media (max-width: 992px) {
  .fc .fc-button {
    font-size: 0.875rem;
    padding: 0.35rem 0.7rem;
  }
}

/* Mobile phones */
@media (max-width: 576px) {
  .fc .fc-button {
    font-size: 0.75rem;
    padding: 0.3rem 0.5rem;
    margin: 1px; /* reduce spacing between buttons */
  }

  /* Optional: make the toolbar stack vertically */
  .fc-toolbar.fc-header-toolbar {
    flex-direction: column;
    gap: 0.5rem;
  }
}
</style>



<!-- LEGEND SECTION -->
<style>
  .legend-container-wrapper {
    padding: 1rem 1.25rem;
  }

  .legend-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: #4b4b4b;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .legend-container {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 0.5rem;
  }
/* bago */
  /* Tablet / Small screens - 3 columns (3x3 if 9 items) */
  @media (max-width: 768px) {
    .legend-container {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  /* Smaller phones - 2 columns */
  @media (max-width: 500px) {
    .legend-container {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  /* Super small screens - 1 column */
  @media (max-width: 350px) {
    .legend-container {
      grid-template-columns: 1fr;
    }
  }

  .event-pill {
    border-radius: 0.75rem;
    padding: 0.4rem 0.6rem;
    font-size: 0.78rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #111827;
    white-space: nowrap;
    border: 1px solid rgba(0, 0, 0, 0.05);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
    transition: all 0.2s ease-in-out;
  }

  .event-pill:hover {
    background-color: #f3f4f6 !important;
    color: #111827 !important;
    transform: scale(1.02);
  }

  .event-pill i {
    font-size: 1rem;
    margin-right: 0.4rem;
  }

  /* Softer background color classes */
  .fc-primary { background-color: #dbeafe !important; color: #1d4ed8 !important; }
  .fc-success { background-color: #dcfce7 !important; color: #15803d !important; }
  .fc-danger { background-color: #fee2e2 !important; color: #b91c1c !important; }
  .fc-warning { background-color: #fef3c7 !important; color: #92400e !important; }
  .fc-info-solid { background-color: #cffafe !important; color: #0369a1 !important; }
  .fc-warning-solid { background-color: #fef9c3 !important; color: #78350f !important; }
  .fc-primary-solid { background-color: #e0f2fe !important; color: #1e3a8a !important; }
  .fc-default { background-color: #f3f4f6 !important; color: #374151 !important; }
</style>

<div class="card mb-2 no-shadow">
  <div class="legend-container-wrapper">
    <div class="legend-title">
      <i class="bi bi-info-circle-fill text-primary"></i> Work Event Categories
    </div>

    <div class="legend-container">
      {% set label_classes = {
        'Meeting': 'fc-primary',
        'Training': 'fc-warning',
        'Leave': 'fc-success',
        'Official Travel': 'fc-default',
        'Holiday': 'fc-danger',
        'Public Event': 'fc-info-solid',
        'Administrative': 'fc-primary-solid'
      } %}

      {% set icons = {
        'Meeting': 'bi-people-fill',
        'Training': 'bi-easel-fill',
        'Leave': 'bi-person-dash-fill',
        'Official Travel': 'bi-geo-alt-fill',
        'Holiday': 'bi-stars',
        'Public Event': 'bi-megaphone-fill',
        'Administrative': 'bi-clipboard-check-fill'
      } %}

       {% for event_type, class_name in label_classes.items() %}
        {% set count = event_counts.get(event_type, 0) %}
        <div class="event-pill {{ class_name }}">
          <i class="bi {{ icons[event_type] }}"></i>
          {{ event_type }}
          {% if count > 0 %}
            <span class="fw-normal">({{ count }})</span>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </div>
</div>



<!-- calendar -->
<div class="card">
   <div class="card-header bg-light d-flex justify-content-between align-items-center border-bottom py-4 px-4">
    <div class="d-flex align-items-baseline fw-bold fs-3 gap-3">
       <span class="text-dark mb-0">{{ current_day }}</span>
      <span class="text-muted">|</span>
      <span class="text-dark">{{ current_date }}</span>
    </div>

 
    </div>
        <div id="calendar" class="mt-2"></div>
      </div>
   



<!-- Interview Details Modal -->
<div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg"> <!-- Centered + Large -->
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title w-100 text-center" id="eventModalLabel">Event Details</h5> <!-- Center title -->
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="eventModalBody">
        <!-- Content inserted dynamically -->
      </div>
    </div>
  </div>
</div>




<script>
  document.addEventListener('DOMContentLoaded', function () {
    const calendarEl = document.getElementById('calendar');

    // Helper: format datetime for input[type="datetime-local"]
    const toDatetimeLocal = (date) => {
      const pad = (n) => (n < 10 ? '0' + n : n);
      return `${date.getFullYear()}-${pad(date.getMonth() + 1)}-${pad(date.getDate())}T${pad(date.getHours())}:${pad(date.getMinutes())}`;
    };

    // Reusable function to show modal
    const showModal = (title, body) => {
      document.getElementById('eventModalLabel').innerText = title;
      document.getElementById('eventModalBody').innerHTML = body;
      new bootstrap.Modal(document.getElementById('eventModal')).show();
    };

    const calendar = new FullCalendar.Calendar(calendarEl, {
  themeSystem: 'bootstrap5',
  initialView: 'dayGridMonth',
  headerToolbar: {
    left: 'prev,next today',
    center: 'title',
    right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
  },


   eventClassNames: function(arg) {
    return typeof arg.event.classNames === 'function'
      ? arg.event.classNames()
      : arg.event.classNames;
  },

  
  eventSources: [
    {
      url: '/admin/calendar-events',
      extraParams: { source: 'calendar' },
      color: '#3788d8'
    },
    {
      url: '/admin/interview-events',
      extraParams: { source: 'interview' },
      color: '#28a745'
    }
  ],

 

  eventClick: function (info) {
    const event = info.event;
    const props = event.extendedProps;

    const source = props.source;

    if (source === 'interview') {
        const dateOptions = {
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: 'numeric',
          minute: '2-digit',
          hour12: true
        };

        const formattedDate = event.start
          ? new Date(event.start).toLocaleString('en-US', dateOptions)
          : 'N/A';

        const content = `
           <div class="mb-4 text-center">
        <h4 class="fw-semibold text-primary mb-2">${event.title}</h4>
        <p class="text-muted mb-0">${formattedDate}</p>
      </div>

          <div class="mb-3">
            <h6 class="fw-bold fs-4 mb-1">Method</h6>
            <p class="text-muted fs-5 mb-3">${props.method || 'N/A'}</p>
            <hr>
            <h6 class="fw-bold fs-4 mb-1">Interviewer</h6>
            <p class="text-muted fs-5 mb-3">${props.interviewer || 'N/A'}</p>
            <hr>
            <h6 class="fw-bold fs-4 mb-1">Status</h6>
            <p class="text-muted fs-5 mb-3">${props.status || 'N/A'}</p>
            <hr>
            <h6 class="fw-bold fs-4 mb-1">Date and Time</h6>
            <p class="text-muted fs-5 ">${formattedDate}</p>
          </div>
        `;

        showModal('Interview Details', content);
      }
else {
    const dateOptionsFull = {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    hour: 'numeric',
    minute: '2-digit',
    hour12: true
  };

  const timeOnlyOptions = {
    hour: 'numeric',
    minute: '2-digit',
    hour12: true
  };

  const startDate = event.start ? new Date(event.start) : null;
  const endDate = event.end ? new Date(event.end) : null;

  let formattedDateRange = startDate
    ? startDate.toLocaleString('en-US', dateOptionsFull)
    : 'N/A';

  if (startDate && endDate) {
    const isSameDay =
      startDate.getFullYear() === endDate.getFullYear() &&
      startDate.getMonth() === endDate.getMonth() &&
      startDate.getDate() === endDate.getDate();

    if (isSameDay) {
      const datePart = startDate.toLocaleDateString('en-US', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
      const startTime = startDate.toLocaleString('en-US', timeOnlyOptions);
      const endTime = endDate.toLocaleString('en-US', timeOnlyOptions);
      formattedDateRange = `${datePart}, ${startTime} – ${endTime}`;
    } else {
      const formattedStart = startDate.toLocaleString('en-US', dateOptionsFull);
      const formattedEnd = endDate.toLocaleString('en-US', dateOptionsFull);
      formattedDateRange = `${formattedStart} – ${formattedEnd}`;
    }
  }

  const content = `
    <div class="mb-4 text-center">
      <h4 class="fw-semibold text-primary mb-2">${event.title}</h4>
      <p class="text-muted mb-0">${formattedDateRange}</p>
    </div>

    <div class="mb-3">
      <h6 class="fw-bold fs-4 mb-1">Event Type</h6>
      <p class="text-muted fs-5 mb-3">${props.label || 'N/A'}</p>
      <hr>
      <h6 class="fw-bold fs-4 mb-1">Description / Location</h6>
      <p class="text-muted fs-5 mb-3">${props.location || 'N/A'}</p>
      <hr>
      <h6 class="fw-bold fs-4 mb-1">Date and Time</h6>
      <p class="text-muted fs-5">${formattedDateRange}</p>
    </div>
  `;

  showModal('', content);
    }
  }
});


    calendar.render();
  });
</script>

{% endblock content %}